library(readr)
library(dplyr)

# Load and filter data
data <- read_csv("final_summary_statistics_with_top_summary_st (1).csv") %>% 
  filter(!`District Number` %in% c("Average", "Minimum", "Maximum", "SD")) %>% 
  mutate(across(all_of(columns_to_compare), as.numeric))

# Enhanced paired t-test function with both test types
compute_p_matrix <- function(df, cols) {
  n <- length(cols)
  p_matrix <- matrix(NA, n, n, dimnames = list(cols, cols))
  
  for(i in 1:(n-1)) {
    for(j in (i+1):n) {
      # Two-sided test
      test_two <- t.test(df[[cols[i]]], df[[cols[j]]], 
                        paired = TRUE, alternative = "two.sided")
      p_two <- round(test_two$p.value, 3)
      
      # One-sided test (first strategy > second strategy)
      test_one <- t.test(df[[cols[i]]], df[[cols[j]]], 
                        paired = TRUE, alternative = "greater")
      p_one <- round(test_one$p.value, 3)
      
      # Format both p-values
      format_p <- function(p) {
        ifelse(p < 0.001, "<0.001",
              ifelse(p == 0.077, "<0.077",
                     format(p, nsmall = 3)))
      }
      
      p_matrix[i,j] <- paste0(
        format_p(p_two), " (", format_p(p_one), ")"
      )
    }
  }
  
  # Set diagonal values (self-comparison)
  diag(p_matrix) <- "1.000 (0.500)"
  
  return(p_matrix)
}

# Generate and print matrix
p_values <- compute_p_matrix(data, columns_to_compare)
print(p_values, na.print = "")
